<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulaire de contact – Exemple complet</title>
  <style>
    /* Zone d'affichage de la confirmation (succès ou erreur) */
    .contact-form-message {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-weight: 500;
    }
    .contact-form-message.success { background: #d1fae5; border: 1px solid #059669; color: #047857; }
    .contact-form-message.error { background: #fee2e2; border: 1px solid #dc2626; color: #b91c1c; }
    .contact-form-box label { display: block; margin-bottom: 1rem; }
    .contact-form-box label span { display: block; font-weight: 600; margin-bottom: 0.35rem; }
    .contact-form-box input, .contact-form-box textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      font-size: 1rem;
    }
    .contact-form-box textarea { min-height: 120px; resize: vertical; }
    .contact-form-box button {
      background: #b91c1c;
      color: #fff;
      font-weight: 600;
      border: none;
      padding: 0.75rem 1.75rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    .contact-form-box button:hover { background: #991b1b; }
    .contact-form-box button:disabled { opacity: 0.7; cursor: not-allowed; }
  </style>
</head>
<body>

  <!-- ========================================================================
       FORMULAIRE DE CONTACT – Code complet avec commentaires
       ========================================================================
       Champs : Nom, Email, Message.
       Méthode : POST vers un script serveur (Node.js /api/contact).
       Pas de mailto: – tout passe par le serveur.
       Confirmation : "Message envoyé avec succès !" ou "Erreur lors de l'envoi."
       ======================================================================== -->

  <div class="contact-form-box" style="max-width: 480px; margin: 2rem auto; padding: 2rem; border: 1px solid #e2e8f0; border-radius: 8px;">
    <h2 style="margin-top: 0;">Contact</h2>

    <!-- Zone où s'affiche la confirmation après envoi (succès ou erreur) -->
    <div id="contact-form-message" class="contact-form-message" role="status" aria-live="polite" hidden></div>

    <!-- Formulaire : method="post", pas d'action (soumission gérée en JavaScript vers le script serveur) -->
    <form id="form-contact" method="post" novalidate>
      <!-- Champ Nom -->
      <label>
        <span>Nom</span>
        <input type="text" name="nom" required placeholder="Votre nom" />
      </label>
      <!-- Champ Email -->
      <label>
        <span>Email</span>
        <input type="email" name="email" required placeholder="votre@email.fr" />
      </label>
      <!-- Champ Message -->
      <label>
        <span>Message</span>
        <textarea name="message" required rows="4" placeholder="Votre message..."></textarea>
      </label>
      <button type="submit" id="contact-submit">Envoyer</button>
    </form>
  </div>

  <script>
    (function () {
      // ----- URL du script serveur qui reçoit les données en POST et envoie l'email -----
      // En production : même origine, ex. '/api/contact'
      // En local (fichier ouvert en file://) : adapter si besoin, ex. 'http://localhost:3000/api/contact'
      var formEndpoint = (typeof window.CONTACT_API_URL !== 'undefined')
        ? window.CONTACT_API_URL
        : (typeof location !== 'undefined' && location.protocol === 'file:'
            ? 'http://localhost:3000/api/contact'
            : '/api/contact');

      var form = document.getElementById('form-contact');
      var messageEl = document.getElementById('contact-form-message');
      var submitBtn = document.getElementById('contact-submit');

      // ----- Affiche la confirmation côté utilisateur : "Message envoyé avec succès !" ou "Erreur lors de l'envoi." -----
      function showMessage(text, isError) {
        messageEl.textContent = text;
        messageEl.className = 'contact-form-message ' + (isError ? 'error' : 'success');
        messageEl.hidden = false;
      }

      function hideMessage() {
        messageEl.hidden = true;
      }

      // ----- Validation basique de l'email côté client (le serveur refait une validation + nettoyage) -----
      function validateEmail(email) {
        var re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(String(email).trim());
      }

      // ----- Soumission : envoi en POST vers le script serveur (pas de mailto) -----
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        hideMessage();

        var nom = (form.querySelector('[name="nom"]') || {}).value;
        var email = (form.querySelector('[name="email"]') || {}).value;
        var message = (form.querySelector('[name="message"]') || {}).value;

        nom = nom ? nom.trim() : '';
        email = email ? email.trim() : '';
        message = message ? message.trim() : '';

        if (!nom) {
          showMessage('Veuillez indiquer votre nom.', true);
          return;
        }
        if (!email) {
          showMessage('Veuillez indiquer votre adresse email.', true);
          return;
        }
        if (!validateEmail(email)) {
          showMessage('Veuillez saisir une adresse email valide.', true);
          return;
        }
        if (!message) {
          showMessage('Veuillez saisir votre message.', true);
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Envoi en cours…';

        // Corps de la requête POST : nom, email, message (le serveur nettoie et sécurise les données)
        var payload = { nom: nom, email: email, message: message };

        fetch(formEndpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify(payload)
        })
          .then(function (res) {
            return res.text().then(function (text) {
              var data = null;
              if (text && (text.trim().charAt(0) === '{')) {
                try {
                  data = JSON.parse(text);
                } catch (_) {}
              }
              if (!res.ok) {
                var err = new Error(data && data.message ? data.message : 'Erreur lors de l\'envoi.');
                throw err;
              }
              if (data && data.success === false) {
                throw new Error(data.message || 'Erreur lors de l\'envoi.');
              }
              return data;
            });
          })
          .then(function (data) {
            showMessage(data && data.message ? data.message : 'Message envoyé avec succès !', false);
            form.reset();
          })
          .catch(function (err) {
            showMessage(err.message || 'Erreur lors de l\'envoi.', true);
          })
          .finally(function () {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Envoyer';
          });
      });
    })();
  </script>
</body>
</html>
